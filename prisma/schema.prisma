generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String      @id
  email     String      @unique
  userGroups UserGroup[]
  documents documents[]

  @@map("users")
}

model Group {
  id          String      @id @default(uuid())
  groupName   String      @unique
  userGroups  UserGroup[]
  groupRoles  GroupRole[]
  targetUsers TargetUser[]

  @@map("groups")
}

model Role {
  id            String          @id @default(uuid())
  roleName      String          @unique
  groupRoles    GroupRole[]
  rolePermissions RolePermission[]

  @@map("roles")
}

model Permission {
  id              String          @id @default(uuid())
  permissionName  String          
  access          String
  rolePermissions RolePermission[]

  @@map("permissions")
}

model UserGroup {
  userId    String
  groupId   String
  user      User    @relation(fields: [userId], references: [id])
  group     Group   @relation(fields: [groupId], references: [id])

  @@id([userId, groupId])
  @@map("user_groups")
}

model GroupRole {
  groupId   String
  roleId    String
  group     Group   @relation(fields: [groupId], references: [id])
  role      Role    @relation(fields: [roleId], references: [id])

  @@id([groupId, roleId])
  @@map("group_roles")
}

model RolePermission {
  roleId       String
  permissionId String
  role         Role       @relation(fields: [roleId], references: [id])
  permission   Permission @relation(fields: [permissionId], references: [id])

  @@id([roleId, permissionId])
  @@map("role_permissions")
}

model TargetUser {
  groupId     String
  targetUser  String  @unique
  group       Group   @relation(fields: [groupId], references: [id])

  @@map("target_users")
}

model I9Users {
  user_id                   String    @id @default(uuid())
  first_name                String    @db.VarChar(100)
  last_name                 String    @db.VarChar(100)
  email                     String    @unique @db.VarChar(255)
  phone_number              String?   @db.VarChar(20)
  created_at                DateTime  @default(now())
  work_start_date           DateTime?
  prepartor                  String?   @db.VarChar(100)
  address_apt               String?   @db.VarChar(50)
  address_street            String?   @db.VarChar(255)
  alien_registration_number String?   @db.VarChar(50)
  citizenship_status        String?   @db.VarChar(100)
  city                      String?   @db.VarChar(100)
  country_of_issuance       String?   @db.VarChar(100)
  date_of_birth             DateTime?
  employee_signature        String?
  foreign_passport_number   String?   @db.VarChar(50)
  i94_admission_number      String?   @db.VarChar(50)
  middle_initial            String?   @db.VarChar(10)
  other_last_names          String?   @db.VarChar(100)
  signed_date               DateTime?
  ssn                       String?   @unique @db.VarChar(11)
  state                     String?   @db.VarChar(100)
  uscis_a_number            String?   @db.VarChar(50)
  work_authorization_expiry DateTime?
  zip_code                  String?   @db.VarChar(20)
  i9_forms                  I9Forms[]

  @@map("i9_users")
}

model I9Forms {
  form_id             String             @id @default(uuid())
  user_id             String
  form_status         String             @db.VarChar(50)
  submission_date     DateTime
  updated_at          DateTime           @updatedAt
  audit_trail         AuditTrail[]
  i9_documents        I9Documents[]
  i9_employee_section I9EmployeeSection?
  i9_employer_section I9EmployerSection?
  user                I9Users            @relation(fields: [user_id], references: [user_id])
  i9_reverification   I9Reverification?

  @@map("i9_forms")
}

model I9EmployeeSection {
  section_id                String    @id @default(uuid())
  form_id                   String    @unique
  employee_name             String    @db.VarChar(255)
  date_of_birth             DateTime
  ssn                       String    @unique @db.VarChar(11)
  citizenship_status        String    @db.VarChar(50)
  alien_registration_number String?   @db.VarChar(50)
  work_authorization_expiry DateTime?
  signature                 String
  signed_date               DateTime
  form                      I9Forms   @relation(fields: [form_id], references: [form_id])

  @@map("i9_employee_section")
}

model I9EmployerSection {
  section_id              String   @id @default(uuid())
  form_id                 String   @unique
  employer_name           String   @db.VarChar(255)
  employer_address        String   @db.VarChar(255)
  title                   String   @db.VarChar(255)
  signature               String
  signed_date             DateTime
  first_day_of_employment DateTime
  form                    I9Forms  @relation(fields: [form_id], references: [form_id])

  @@map("i9_employer_section")
}

model I9Documents {
  document_id       String    @id @default(uuid())
  form_id           String
  document_type     String    @db.VarChar(100)
  document_number   String?   @db.VarChar(100)
  document_expiry   DateTime?
  issuing_authority String    @db.VarChar(255)
  uploaded_file     String
  uploaded_at       DateTime  @default(now())
  document_title    String    @db.VarChar(255)
  form              I9Forms   @relation(fields: [form_id], references: [form_id])

  @@map("i9_documents")
}

model I9Reverification {
  reverification_id              String    @id @default(uuid())
  form_id                        String    @unique
  updated_at                     DateTime  @updatedAt
  additional_information         String?
  employer_name                  String    @db.VarChar(255)
  employer_signature             String
  employer_signed_date           DateTime
  new_first_name                 String?   @db.VarChar(100)
  new_last_name                  String?   @db.VarChar(100)
  new_middle_initial             String?   @db.VarChar(10)
  rehire_date                    DateTime?
  reverification_document_expiry DateTime?
  reverification_document_number String?   @db.VarChar(100)
  reverification_document_title  String?   @db.VarChar(100)
  used_dhs_alternative           Boolean?
  form                           I9Forms   @relation(fields: [form_id], references: [form_id])

  @@map("i9_reverification")
}

model AuditTrail {
  audit_id     String   @id @default(uuid())
  form_id      String
  action       String   @db.VarChar(50)
  performed_by String
  performed_at DateTime @default(now())
  form         I9Forms  @relation(fields: [form_id], references: [form_id])

  @@map("audit_trail")
}

model documents {
  id            Int       @id @default(autoincrement())
  user_id       String    @db.VarChar(50)
  file_id       String    @unique @db.VarChar(50)
  s3_path       String    @db.VarChar(255)
  document_type String?   @db.VarChar(100)
  details       Json?
  created_at    DateTime? @default(now()) @db.Timestamp(6)
  users         User      @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model passport_data {
  id                Int       @id @default(autoincrement())
  file_id           String    @unique @db.VarChar(50)
  s3_path           String    @db.VarChar(255)
  passport_number   String?   @db.VarChar(30)
  full_name         String?   @db.VarChar(100)
  surname           String?   @db.VarChar(100)
  given_names       String?   @db.VarChar(100)
  nationality       String?   @db.VarChar(50)
  date_of_birth     String?   @db.VarChar(20)
  place_of_birth    String?   @db.VarChar(100)
  gender            String?   @db.VarChar(10)
  issue_date        String?   @db.VarChar(20)
  expiry_date       String?   @db.VarChar(20)
  issuing_authority String?   @db.VarChar(100)
  mrz_data          String?
  confidence_score  Float?
  raw_text          String?
  created_at        DateTime? @default(now()) @db.Timestamp(6)
}

model NotificationLog {
  id              String   @id @default(uuid())
  sender_email    String   @db.VarChar(255)
  sender_name     String   @db.VarChar(255)
  recipient_email String   @db.VarChar(255)
  recipient_name  String   @db.VarChar(255)
  subject         String   @db.VarChar(255)
  message         String   @db.Text
  status          String   @db.VarChar(50)
  error_message   String?  @db.Text
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt

  @@map("notification_logs")
}
